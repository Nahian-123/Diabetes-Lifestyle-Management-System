<!DOCTYPE html>
<html>
<head>
    <title>Face Verification</title>
</head>
<body>

<h2>Face Verification Required</h2>

<video id="video" width="300" height="220" autoplay></video><br><br>
<button id="captureBtn">Verify Face</button>

<canvas id="canvas" width="300" height="220" style="display:none;"></canvas>

<script>
navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
        document.getElementById("video").srcObject = stream;
    });

document.getElementById("captureBtn").onclick = async function () {
    let video = document.getElementById("video");
    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");

    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    let base64Image = canvas.toDataURL("image/jpeg");

    const res = await fetch("/verify-face", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ live_image: base64Image })
    });

    let data = await res.json();

    if (data.match) {
        window.location = data.redirect;
    } else {
        alert(data.message);
    }
};
</script>

</body>
</html>
